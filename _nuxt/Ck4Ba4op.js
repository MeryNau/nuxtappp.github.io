import{n as E,t as b,i as _}from"./t89mLwvR.js";import{a3 as S,r as w,Q as A,G as $,L as j,a4 as O,_ as J,d as B,g as F,T as Y,U as p,o as M,c as P,A as U,a5 as V}from"./BFoAKb-g.js";function W(e,r,n){let s;S(n)?s={evaluating:n}:s=n||{};const{lazy:u=!1,evaluating:a=void 0,shallow:d=!0,onError:l=E}=s,i=w(!u),c=d?A(r):w(r);let t=0;return $(async o=>{if(!i.value)return;t++;const f=t;let m=!1;a&&Promise.resolve().then(()=>{a.value=!0});try{const h=await e(v=>{o(()=>{a&&(a.value=!1),m||v()})});f===t&&(c.value=h)}catch(h){l(h)}finally{a&&f===t&&(a.value=!1),m=!0}}),u?j(()=>(i.value=!0,c.value)):c}function X(e){var r;const n=b(e);return(r=n==null?void 0:n.$el)!=null?r:n}const y=new Map;function Z(e){const r=O();function n(l){var i;const c=y.get(e)||new Set;c.add(l),y.set(e,c);const t=()=>u(l);return(i=r==null?void 0:r.cleanups)==null||i.push(t),t}function s(l){function i(...c){u(i),l(...c)}return n(i)}function u(l){const i=y.get(e);i&&(i.delete(l),i.size||a())}function a(){y.delete(e)}function d(l,i){var c;(c=y.get(e))==null||c.forEach(t=>t(l,i))}return{on:n,once:s,off:u,emit:d,reset:a}}class g extends Error{constructor(r){super(r),this.message=r,Object.setPrototypeOf(this,g.prototype)}}const x=B({props:{schema:{type:Object,default:void 0},state:{type:Object,required:!0},validate:{type:Function,default:()=>[]},validateOn:{type:Array,default:()=>["blur","input","change","submit"]}},emits:["submit","error"],setup(e,{expose:r,emit:n}){const s=_("$Z55GngiEgp"),u=Z(`form-${s}`);F(()=>{u.on(async t=>{var o;t.type!=="submit"&&((o=e.validateOn)!=null&&o.includes(t.type))&&await i(t.path,{silent:!0})})}),Y(()=>{u.reset()});const a=w([]);p("form-errors",a),p("form-events",u);const d=w({});p("form-inputs",d);async function l(){let t=await e.validate(e.state);if(e.schema)if(I(e.schema))t=t.concat(await q(e.state,e.schema));else if(z(e.schema))t=t.concat(await G(e.state,e.schema));else if(L(e.schema))t=t.concat(await Q(e.state,e.schema));else if(T(e.schema))t=t.concat(await D(e.state,e.schema));else throw new Error("Form validation failed: Unsupported form schema");return t}async function i(t,o={silent:!1}){let f=t;if(t&&!Array.isArray(t)&&(f=[t]),f){const m=a.value.filter(v=>!f.includes(v.path)),h=(await l()).filter(v=>f.includes(v.path));a.value=m.concat(h)}else a.value=await l();if(a.value.length>0){if(o.silent)return!1;throw new g(`Form validation failed: ${JSON.stringify(a.value,null,2)}`)}return e.state}async function c(t){var f;const o=t;try{(f=e.validateOn)!=null&&f.includes("submit")&&await i();const m={...o,data:e.state};n("submit",m)}catch(m){if(!(m instanceof g))throw m;const h={...o,errors:a.value.map(v=>({...v,id:d.value[v.path]}))};n("error",h)}}return r({validate:i,errors:a,setErrors(t,o){a.value=t,o?a.value=a.value.filter(f=>f.path!==o).concat(t):a.value=t},async submit(){await c(new Event("submit"))},getErrors(t){return t?a.value.filter(o=>o.path===t):a.value},clear(t){t?a.value=a.value.filter(o=>o.path!==t):a.value=[]}}),{onSubmit:c}}});function z(e){return e.validate&&e.__isYupSchema__}function C(e){return e.inner!==void 0}async function G(e,r){try{return await r.validate(e,{abortEarly:!1}),[]}catch(n){if(C(n))return n.inner.map(s=>({path:s.path??"",message:s.message}));throw n}}function I(e){return e.parse!==void 0}async function q(e,r){const n=await r.safeParseAsync(e);return n.success===!1?n.error.issues.map(s=>({path:s.path.join("."),message:s.message})):[]}function L(e){return e.validateAsync!==void 0&&e.id!==void 0}function N(e){return e.isJoi===!0}async function Q(e,r){try{return await r.validateAsync(e,{abortEarly:!1}),[]}catch(n){if(N(n))return n.details.map(s=>({path:s.path.join("."),message:s.message}));throw n}}function T(e){return e._parse!==void 0}async function D(e,r){const n=await r._parse(e);return n.issues?n.issues.map(s=>{var u;return{path:((u=s.path)==null?void 0:u.map(a=>a.key).join("."))||"",message:s.message}}):[]}function H(e,r,n,s,u,a){return M(),P("form",{onSubmit:r[0]||(r[0]=V((...d)=>e.onSubmit&&e.onSubmit(...d),["prevent"]))},[U(e.$slots,"default")],32)}const k=J(x,[["render",H]]);export{k as _,W as c,X as u};
